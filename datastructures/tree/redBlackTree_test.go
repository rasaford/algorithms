package tree

import (
	"reflect"
	"testing"
)

func Test_rbTree_Insert(t *testing.T) {
	type args struct {
		key   int
		value interface{}
	}
	tests := []struct {
		name string
		t    Tree
		args []args
	}{
		{
			"1..10",
			NewRedBlackTree(),
			[]args{
				{1, 1},
				{2, 2},
				{3, 3},
				{4, 4},
				{5, 5},
				{6, 6},
				{7, 7},
				{8, 8},
				{9, 9},
				{10, 10},
			},
		},
		{
			"duplicated keys",
			NewRedBlackTree(),
			[]args{
				{1, 1},
				{1, 1},
				{1, 1},
				{1, 1},
				{1, 1},
				{1, 1},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			for _, arg := range tt.args {
				tt.t.Insert(arg.key, arg.value)
			}
			for _, arg := range tt.args {
				if res := tt.t.Search(arg.key); res != arg.value {
					t.Errorf("Node.Insert(), want %v; got: %v", arg.value, res)
				}
			}
		})
	}
}

func Test_rbTree_Search(t *testing.T) {
	tree := NewRedBlackTree()
	tree.Insert(3, 3)
	tree.Insert(2, 2)
	tree.Insert(4, 4)
	tree.Insert(1, 1)
	tree.Insert(5, 5)
	type args struct {
		key int
	}
	tests := []struct {
		name string
		t    Tree
		args args
		want interface{}
	}{
		{
			"empty tree",
			NewRedBlackTree(),
			args{55},
			nil,
		},
		{
			"node contained",
			tree,
			args{5},
			5,
		},
		{
			"node not contained",
			tree,
			args{-5},
			nil,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if got := tt.t.Search(tt.args.key); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("binaryTree.Search() = %v, want %v", got, tt.want)
			}
		})
	}
}

func Test_rb_successor(t *testing.T) {
	tree := NewRedBlackTree().(*rbTree)
	tree.Insert(3, 3)
	tree.Insert(2, 2)
	tree.Insert(4, 4)
	tree.Insert(1, 1)
	tree.Insert(5, 5)
	type args struct {
		node RedBlackNode
	}
	tests := []struct {
		name string
		t    *rbTree
		args args
		want RedBlackNode
	}{
		{
			"1",
			tree,
			args{tree.search(1)},
			tree.search(2),
		},
		{
			"2",
			tree,
			args{tree.search(2)},
			tree.search(3),
		},
		{
			"3",
			tree,
			args{tree.search(3)},
			tree.search(4),
		},
		{
			"4",
			tree,
			args{tree.search(4)},
			tree.search(5),
		},
		{
			"not contained, large key",
			tree,
			args{tree.search(5)},
			nil,
		},
		{
			"not contained, nil key",
			tree,
			args{tree.search(555)},
			nil,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if got := tt.t.Successor(tt.args.node); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("binaryTree.Successor() = %v, want %v", got, tt.want)
			}
		})
	}
}

func Test_rbTree_predecessor(t *testing.T) {
	tree := NewRedBlackTree().(*rbTree)
	tree.Insert(3, 3)
	tree.Insert(2, 2)
	tree.Insert(4, 4)
	tree.Insert(1, 1)
	tree.Insert(5, 5)
	type args struct {
		node RedBlackNode
	}
	tests := []struct {
		name string
		t    *rbTree
		args args
		want RedBlackNode
	}{
		{
			"2",
			tree,
			args{tree.search(2)},
			tree.search(1),
		},
		{
			"3",
			tree,
			args{tree.search(3)},
			tree.search(2),
		},
		{
			"4",
			tree,
			args{tree.search(4)},
			tree.search(3),
		},
		{
			"5",
			tree,
			args{tree.search(5)},
			tree.search(4),
		},
		{
			"not contained, small key",
			tree,
			args{tree.search(1)},
			nil,
		},
		{
			"not contained, nil key",
			tree,
			args{tree.search(555)},
			nil,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if got := tt.t.Predecessor(tt.args.node); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("binaryTree.Successor() = %v, want %v", got, tt.want)
			}
		})
	}
}

func Test_rbTree_Delete(t *testing.T) {
	type args struct {
		key   int
		value interface{}
	}
	tests := []struct {
		name string
		t    Tree
		args []args
	}{
		{
			"root delete",
			NewRedBlackTree(),
			[]args{
				{1, 1},
				{2, 2},
				{3, 3},
				{4, 4},
				{5, 5},
				{6, 6},
				{7, 7},
				{8, 8},
				{9, 9},
				{10, 10},
			},
		},
		{
			"non root delete",
			NewRedBlackTree(),
			[]args{
				{6, 6},
				{7, 7},
				{8, 8},
				{9, 9},
				{10, 10},
				{1, 1},
				{2, 2},
				{3, 3},
				{4, 4},
				{5, 5},
			},
		},
		{
			"random delete",
			NewRedBlackTree(),
			[]args{
				{224756258, 945986064},
				{353390024, -133757764},
				{-161839742, 401199495},
				{-932787398, -737619283},
				{-865501367, -427538523},
				{32668871, 673536688},
				{-613613661, -256286734},
				{-390717095, -66808549},
				{-465930612, -444310378},
				{384581414, -604402717},
				{-637401328, -298776357},
				{151769705, 778444435},
				{-444283776, -435761876},
				{542396464, -630108935},
				{784550967, 422451192},
				{51153718, -1012961415},
				{-733734436, 230325008},
				{1020573606, -903116467},
				{203599914, -946781192},
				{412369662, -426226797},
				{-701655410, 88261267},
				{94823371, -475651260},
				{-165029390, 65682324},
				{-529267745, -467977499},
				{619774336, -296770470},
				{817210134, -435698102},
				{846885366, -864459624},
				{1024171177, -914203118},
				{-596378935, 388862715},
				{-555092120, -404752468},
				{929530628, 519366687},
				// {646510782, 494418333},
				// {-680913557, -153851995},
				// {852533738, 392245379},
				// {1028492960, 906693923},
				// {-878670260, -14727447},
				// {916947179, 976987895},
				// {-326516376, 409823271},
				// {452919754, 136965640},
				// {321026173, 111164597},
				// {549376800, -206580870},
				// {-793170686, 1043601310},
				// {851137418, -382071764},
				// {474911210, 310396820},
				// {-890087932, 364160179},
				// {263557055, -279832487},
				// {-565169277, 75767284},
				// {-671633883, -560835320},
				// {275088729, -801541980},
				// {-469589618, -192580225},
				// {-139774398, 268639528},
				// {107689692, 265447934},
				// {492161864, 709816187},
				// {-1072638413, 506953462},
				// {-214783233, -4578191},
				// {223291275, -194093270},
				// {-1010023232, -1069653241},
				// {-1067636439, 892969474},
				// {192917444, 127544314},
				// {677327448, 811774071},
				// {-89244097, 215103979},
				// {-1017337842, 742670256},
				// {-537529757, 304479447},
				// {-542311330, -700818737},
				// {198907996, 675157158},
				// {416264229, -1008624648},
				// {84203062, 1021503887},
				// {538509564, -442368074},
				// {543659705, -749549005},
				// {-309737439, 712816080},
				// {-575890599, 274522724},
				// {-3448211, -880820291},
				// {-1019638207, -231463984},
				// {191948717, 922583963},
				// {154805228, 190216253},
				// {-189488183, 112915528},
				// 		{-18022979, 983448541},
				// 		{638250482, -843142640},
				// 		{607812978, -229241733},
				// 		{-793680221, -665649565},
				// 		{515021944, 330801408},
				// 		{-862464245, 43766331},
				// 		{-859574001, -747660600},
				// 		{-910124481, -396837615},
				// 		{-730894080, -777809855},
				// 		{-380940657, 83911887},
				// 		{152152712, 27448617},
				// 		{395513081, 328651339},
				// 		{52612834, 331292592},
				// 		{464647548, 293441216},
				// 		{-1046198393, -1007852310},
				// 		{-863222123, -281080464},
				// 		{701054897, -327101040},
				// 		{-334330953, -530428839},
				// 		{-608873576, 118116187},
				// 		{-210301258, 13952339},
				// 		{-711504994, -362133903},
				// 		{704220225, 430114933},
				// 		{-949346128, 1071936843},
				// 		{-189965623, -833922367},
				// 		{602914806, -875920731},
				// 		{-958862992, 461055754},
				// 		{-535233937, 748683497},
				// 		{1017653576, -617270661},
				// 		{-1027498376, 956048469},
				// 		{-874089935, 313174788},
				// 		{-403972720, -110671935},
				// 		{-27403505, -896618067},
				// 		{369000196, -214344016},
				// 		{859584334, 966116829},
				// 		{-387983148, -1319642},
				// 		{-213819970, -1031203028},
				// 		{311468594, -153140430},
				// 		{-344463353, 832037173},
				// 		{-566232437, 569100809},
				// 		{-996959303, 488718437},
				// 		{270232099, 28105206},
				// 		{-918160162, 481528237},
				// 		{815710597, 1025989256},
				// 		{746251131, 713389641},
				// 		{-541499763, 887767728},
				// 		{-912600642, 719629934},
				// 		{277737693, 540608777},
				// 		{283475216, -865577186},
				// 		{-1041900290, 180033738},
				// 		{-926089019, 1070034862},
				// 		{320379686, 1042529392},
				// 		{718989896, -360656809},
				// 		{346589217, 979296839},
				// 		{-406926083, -677765823},
				// 		{1003077461, 715631350},
				// 		{-408991588, 656854620},
				// 		{-177541402, 469290567},
				// 		{-200281249, 849981046},
				// 		{983926247, -1033555487},
				// 		{626361515, -164168351},
				// 		{-1041140279, -144529428},
				// 		{869250351, 763869414},
				// 		{-981568299, 341515470},
				// 		{-326720217, 7487825},
				// 		{730031529, -1024114403},
				// 		{-806673201, -512871452},
				// 		{719294294, -397703672},
				// 		{-1057246558, 858456859},
				// 		{-278598344, -858565231},
				// 		{307528306, 579582408},
				// 		{625186898, -510280968},
				// 		{-328857312, -612776480},
				// 		{691689230, -319686657},
				// 		{213018036, 168258044},
				// 		{-185583415, -816364815},
				// 		{883933705, -958238170},
				// 		{-582145049, -377583539},
				// 		{-320479448, -323649949},
				// 		{-421331717, 1006624714},
				// 		{368350463, -627187356},
				// 		{994584291, -424767165},
				// 		{661298436, -785798277},
				// 		{961557900, 302504901},
				// 		{973365764, 665449834},
				// 		{-683778449, 950814216},
				// 		{711334708, -11423677},
				// 		{763023160, 452569105},
				// 		{-486416307, -198356897},
				// 		{879955654, 954335589},
				// 		{-2936787, -453895772},
				// 		{1021977282, -101824061},
				// 		{-977125034, -396507125},
				// 		{970461064, 540227607},
				// 		{76860586, 364459305},
				// 		{784207336, -88294962},
				// 		{168686779, -39664405},
				// 		{108696522, 967706048},
				// 		{21185830, 520796417},
				// 		{-19769703, -931682742},
				// 		{-510047418, 913685453},
				// 		{-275980314, -194520357},
				// 		{-180921267, -864874128},
				// 		{862488757, -1064196989},
				// 		{-485493346, -839007556},
				// 		{763319655, -521719648},
				// 		{1050403170, 915711557},
				// 		{-706638015, -421149192},
				// 		{71836442, -694733265},
				// 		{673431061, 440528619},
				// 		{-521392800, -536078661},
				// 		{-354132150, 539535149},
				// 		{-1063262570, 732277335},
				// 		{-580736296, -1045211327},
				// 		{966233225, 857643690},
				// 		{993477908, -981399249},
				// 		{456689483, -964018083},
				// 		{-198573292, -52189491},
				// 		{-327559146, -986296421},
				// 		{209521831, -515128340},
				// 		{714802507, 988910863},
				// 		{937822364, -581280361},
				// 		{473118781, 550791598},
				// 		{-107043630, -345793425},
				// 		{-59072867, 1043664942},
				// 		{-295640901, -537611778},
				// 		{-970945329, 622162983},
				// 		{550207176, 338162201},
				// 		{-599150403, 338240221},
				// 		{-234414064, 900342184},
				// 		{-752294699, 43791534},
				// 		{570347030, -540774049},
				// 		{-95683348, 429043917},
				// 		{-897713734, 26353991},
				// 		{-501691278, 261996516},
				// 		{-860990242, -771858692},
				// 		{-731854772, 953515162},
				// 		{282343806, -545907620},
				// 		{1003959872, 79415269},
				// 		{-347503451, 368653452},
				// 		{724702554, 502199439},
				// 		{4769150, -164338806},
				// 		{-79372064, 972905984},
				// 		{524141957, -96229618},
				// 		{-540270417, 472200651},
				// 		{-163848279, 520959900},
				// 		{336829071, 391962099},
				// 		{293756210, -539914249},
				// 		{-242963213, 579758207},
				// 		{-802376428, -458191909},
				// 		{24350700, -647334173},
				// 		{1062159086, 291957454},
				// 		{488163822, -188301152},
				// 		{30115385, -792013625},
				// 		{97930911, 740957056},
				// 		{-443918469, 597652898},
				// 		{-769274236, 331527503},
				// 		{282068187, -227707902},
				// 		{-1070710556, 141447478},
				// 		{832777026, -102042335},
				// 		{206542097, 306736551},
				// 		{708322578, 666536317},
				// 		{-932147850, -898776227},
				// 		{-353222357, -20111748},
				// 		{255614287, 274145049},
				// 		{-376573910, 629673391},
				// 		{-892951864, -527581498},
				// 		{402799623, -171331902},
				// 		{-1026215579, -607744760},
				// 		{-905710387, 137104664},
				// 		{-582880335, -284383600},
				// 		{-489529898, 859637203},
				// 		{347527396, -117832623},
				// 		{1006621291, 359946907},
				// 		{-291198647, -1059510523},
				// 		{-630983772, 606567611},
				// 		{572156796, 661943843},
				// 		{-455460910, 236115222},
				// 		{-102641282, -587316181},
				// 		{-238249584, -543604129},
				// 		{-1057574602, -744155249},
				// 		{-1064101122, 878757927},
				// 		{-562982338, -370949735},
				// 		{629549041, -149697263},
				// 		{-128645607, -859832104},
				// 		{609929759, 47414493},
				// 		{-854295010, 747940693},
				// 		{-721858501, 140454478},
				// 		{-813472268, -482422546},
				// 		{1070162140, 921914394},
				// 		{-851931065, -620899591},
				// 		{-398164644, -59207948},
				// 		{-766078490, -267408083},
				// 		{403305804, 618262711},
				// 		{-1003270271, -866747895},
				// 		{-354724786, 49622824},
				// 		{-325171854, -686611111},
				// 		{890564523, -283250814},
				// 		{-733461719, -878282467},
				// 		{-508635509, -226588234},
				// 		{-667964600, 549440619},
				// 		{303575941, -389376484},
				// 		{275729907, -475786204},
				// 		{-350071870, 166361537},
				// 		{-154070929, -836465838},
				// 		{-328996102, -255585610},
				// 		{654967578, 822565505},
				// 		{-263510066, -687525639},
				// 		{-113165561, -667067540},
				// 		{-861457102, -720190473},
				// 		{-1016780508, 324643717},
				// 		{608752669, -679121481},
				// 		{1020344768, 496580075},
				// 		{-123168422, -534166116},
				// 		{241456089, -1025502128},
				// 		{-866525307, 154629},
				// 		{-562229540, -470278068},
				// 		{-133127054, 892242917},
				// 		{-632514129, 435756275},
				// 		{-64040233, 948495594},
				// 		{-881417941, 578221591},
				// 		{-1034219453, -872044641},
				// 		{968146445, -937977347},
				// 		{7009703, 639402373},
				// 		{97467002, -204576055},
				// 		{-639279061, -390479580},
				// 		{968885428, 625362298},
				// 		{997870890, -717198114},
				// 		{-490534730, 321373047},
				// 		{-524262886, 250109263},
				// 		{-667271982, 988762667},
				// 		{-308083025, 925161762},
				// 		{247827578, 376927235},
				// 		{606538895, -932376431},
				// 		{567500912, 481313992},
				// 		{-809232142, 663255025},
				// 		{75250533, 97763794},
				// 		{-604366749, -965140724},
				// 		{274818750, 255419228},
				// 		{-89908662, -59483363},
				// 		{787989269, 143964701},
				// 		{-201027609, 231974295},
				// 		{-78086760, 761212312},
				// 		{264420925, 418257527},
				// 		{-360368783, 411843829},
				// 		{609333567, 620262843},
				// 		{611153976, 755948937},
				// 		{-409118029, -1015504313},
				// 		{-960433472, -691176157},
				// 		{-253203222, 587828899},
				// 		{-447120763, -272537989},
				// 		{-150415810, -609531661},
				// 		{-375634925, 2721994},
				// 		{-187046730, -455104983},
				// 		{585854230, -554415605},
				// 		{-777014222, 159951183},
				// 		{-355589635, -955318252},
				// 		{304031754, -691011581},
				// 		{87708994, 328907584},
				// 		{-3583539, -534274673},
				// 		{-925116916, 333755399},
				// 		{-183928878, -516848988},
				// 		{928375425, -1016194193},
				// 		{455115081, 745278739},
				// 		{-750307071, -755945048},
				// 		{241486291, 512811384},
				// 		{236423630, 774366878},
				// 		{-892984650, -182368622},
				// 		{644132372, -620048373},
				// 		{-851278778, -617142596},
				// 		{-3786524, -724295685},
				// 		{953666576, 687662792},
				// 		{612279952, -548200880},
				// 		{243933517, -527840963},
				// 		{248001716, -634951230},
				// 		{-918559272, 54604489},
				// 		{881559955, -73950542},
				// 		{774399283, 608921356},
				// 		{716822792, 854595362},
				// 		{167803688, -441910175},
				// 		{-904523509, 1025633270},
				// 		{108275013, -162744868},
				// 		{-45828463, -951695987},
				// 		{-686357917, -556694340},
				// 		{339734305, -179244622},
				// 		{583846789, -796271044},
				// 		{-638964260, -856473680},
				// 		{553951964, 665744709},
				// 		{29989700, -674822100},
				// 		{-1046938998, 86519367},
				// 		{1024398454, 634142978},
				// 		{-28305322, 87512024},
				// 		{970575985, 503375584},
				// 		{-67057164, -375409409},
				// 		{-162590727, 87234329},
				// 		{89209541, 297544765},
				// 		{529331414, -323540023},
				// 		{630929369, -675156685},
				// 		{305610572, -434296626},
				// 		{449488321, 717071255},
				// 		{172809785, 309717904},
				// 		{-1031060760, 889116631},
				// 		{478515529, 335595188},
				// 		{736376578, -860430385},
				// 		{1015325449, 29503265},
				// 		{-698038043, 806281918},
				// 		{367703848, -1048809182},
				// 		{560116491, -209468296},
				// 		{-879754187, -211192485},
				// 		{-860773039, -929584779},
				// 		{-670028586, -77030825},
				// 		{-733429300, -467366429},
				// 		{-864011828, 915004539},
				// 		{957875812, 237340256},
				// 		{-753714716, -1024230395},
				// 		{513874259, -916478328},
				// 		{858789033, 68780055},
				// 		{660879166, 474288249},
				// 		{98457318, -535438908},
				// 		{-305060221, 840068741},
				// 		{642964097, -501332534},
				// 		{-113191320, -798143019},
				// 		{590727477, -389426763},
				// 		{-207684944, 141582064},
				// 		{-919335008, -451235438},
				// 		{229185375, 700640540},
				// 		{278287502, -727535370},
				// 		{-622704572, 485611557},
				// 		{180611509, 910578139},
				// 		{-69586991, 518184635},
				// 		{5576641, -464762385},
				// 		{955677426, -410813035},
				// 		{506093986, -278928407},
				// 		{-804304467, -1057267236},
				// 		{-1043817851, -63692615},
				// 		{84787421, 537702810},
				// 		{-49464477, 774777420},
				// 		{-738645222, 89418450},
				// 		{-497001479, 961488582},
				// 		{596635977, 509849983},
				// 		{208900332, -916344160},
				// 		{84135555, 400282368},
				// 		{-497290262, -985006683},
				// 		{317924489, -186727545},
				// 		{874934621, -916675287},
				// 		{434779489, -705875440},
				// 		{835079588, 872671912},
				// 		{276891148, 281261976},
				// 		{-1039473665, -594896819},
				// 		{310605978, 37972760},
				// 		{-888278007, -554548042},
				// 		{588848473, 490691733},
				// 		{208319266, -530388007},
				// 		{783497494, 14525751},
				// 		{888535954, 761607380},
				// 		{404543843, -418792162},
				// 		{-485903039, 538913100},
				// 		{483776606, -367403712},
				// 		{-476068640, 897482081},
				// 		{851395827, 671759939},
				// 		{222515168, 993667424},
				// 		{-809027313, 234181514},
				// 		{-614240359, 879069850},
				// 		{665548634, 550490580},
				// 		{192375358, -457933185},
				// 		{-896898206, -728754359},
				// 		{-59763147, -575098457},
				// 		{256536312, 438938582},
				// 		{-141092238, -95882718},
				// 		{426554656, 873607518},
				// 		{-371506060, 213053381},
				// 		{-990131504, -792736876},
				// 		{447970060, 870394013},
				// 		{312940387, 776903380},
				// 		{688183507, -173736176},
				// 		{818880084, 654975849},
				// 		{401481981, 405936675},
				// 		{898019868, -1061751398},
				// 		{-673509486, 810071649},
				// 		{1018589320, 74612806},
				// 		{533761181, 131227991},
				// 		{-1039481534, -784887705},
				// 		{-777128931, -883919565},
				// 		{688831827, 1032974257},
				// 		{-568949845, -1039591006},
				// 		{-42201498, -665646610},
				// 		{875772446, -559304688},
				// 		{-1043774913, -250791871},
				// 		{-1017823652, 14328449},
				// 		{-120205614, -549453847},
				// 		{607213164, 275135565},
				// 		{971895323, -189688705},
				// 		{1035336110, -549375805},
				// 		{1072759160, -772646857},
				// 		{-71165530, 35944451},
				// 		{-846658302, 93033250},
				// 		{142960025, -1028397677},
				// 		{-199758819, 966673531},
				// 		{921352140, 638840937},
				// 		{-30747332, -449939964},
				// 		{-368127491, 432131274},
				// 		{-861980824, -811069704},
				// 		{-40134024, -857087898},
				// 		{916425960, -329290245},
				// 		{-342424993, -705589766},
				// 		{259173094, 41541779},
				// 		{-408274901, -215039592},
				// 		{-714750851, -605568595},
				// 		{922397059, 301857782},
				// 		{3821295, 220594862},
				// 		{-685871230, 615105525},
				// 		{17641402, 227018993},
				// 		{433613048, 481249192},
				// 		{-707163747, -820735342},
				// 		{-1000899129, -711051182},
				// 		{320388686, 178282941},
				// 		{-783374665, -411517981},
				// 		{1054163767, 766414},
				// 		{-378843002, -126092379},
				// 		{-859353412, 844073390},
				// 		{-446970599, -932580812},
				// 		{842307710, -817454181},
				// 		{-708825641, 644299395},
				// 		{-297860197, 195012647},
				// 		{580913747, -105929761},
			},
		},
		{
			"duplicated keys",
			NewRedBlackTree(),
			[]args{
				{1, 2},
				{1, 3},
				{1, 4},
				{1, 5},
				{1, 6},
				{1, 7},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			for _, arg := range tt.args {
				tt.t.Insert(arg.key, arg.value)
			}
			for _, arg := range tt.args {
				prev := tt.t.Search(arg.key)
				tt.t.Delete(arg.key)
				if res := tt.t.Search(arg.key); reflect.DeepEqual(prev, res) {
					t.Errorf("binaryTree.Delete(), want %v; got: %v", nil, res)
				}
			}
		})
	}
}
